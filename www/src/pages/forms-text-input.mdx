import Helmet from "react-helmet";

import Layout from '../components/layout';
import Form from '../../../src/modules/forms/tenonForm/Form';
import Input from '../../../src/modules/forms/tenonForm/Input';
import {validator} from '../../../src/modules/utils/helpers/validationHelpers';
import {isRequired, isLongerThan} from '../../../src/modules/utils/data/validation';

export default ({children}) => 
<Layout>
    <Helmet>
        <title>Tenon-ui | Text input</title>
    </Helmet>{children}
</Layout>

## Text input

To create an `<input type="text">`, please use the the `TextInputController` in combination 
with the `Input` view component.

```
import { Form, Input, validator } from '@tenon-io/tenon-ui';

//...

<Form.TextInputController
    name="petType"
    required="true"
    validators={[
        validator(
            isRequired,
            'A type of pet is required'
        )
    ]}
>
    {props => (
        <Input
            {...props}
            requiredText="( required )"
            labelText="Pet type"
        />
    )}
</Form.TextInputController>

//...
```

This will render the following:

<Form
    onSubmit={submitData => {
        alert(JSON.stringify(submitData));
    }}
>
    {({ formControls }) => (
    <>
        <Form.TextInputController
            name="petName"
            required="true"
            validators={[
                validator(isRequired, 'A name is required for your pet')
            ]}
        >
            {props => (
                <Input
                    {...props}
                    requiredText="( required )"
                    labelText="Pet type"
                />
            )}
        </Form.TextInputController>
        <button type="submit">Submit</button>
     </>   
    )}
</Form>

Try to enter some text and activate the `Submit` button. If no text is entered, you should see
a validation message. Otherwise you will see an alert showing the data being submitted by the 
surrounding form.

If you open your browser inspector you will see the following `HTML`:
```
<form novalidate="">
    <div class="form-group">
        <div class="field-wrapper">
            <label for="1bf08342-e063-4b6e-8768-1972fa03ee8e">
                Pet type<span aria-hidden="true"
                              class="required">
                            &nbsp;( required )
                        </span>
            </label>
            <input
            aria-required="true" 
            id="1bf08342-e063-4b6e-8768-1972fa03ee8e" 
            name="petName" 
            type="text" 
            value=""></div>
    </div>
    <button type="submit">Submit</button>
</form>
```

You will notice that a lot is already calculated for you, for example a unique `id` value,
so that you can use as many `Input` components on a page as you want. As well as some `aria=*`
properties.

### The Input view component

The `Tenon-UI Input` component provides you with an accessible view component. We recommend 
using this view component if you want to ensure that your `<input>` fields are accessible.

If we look at the render function shown above, you can see how to use this component:

```
 {props => (
    <Input
        {...props}
        requiredText="( required )"
        labelText="Pet type"
    />
)}
```

If it **VERY** important to spread the props object from the render function of the `TextinputController`
onto the `Input` component. This passes the required props into our view component, that you
would otherwise use when creating your own views.

The reason for this syntax is that you can now also easily set the props of the `Input` component. Note
above how you the `labelText` for this specific component was set.

#### Input component props

##### labelText
This prop is required.

Every input needs a text label. With this prop you provide the text that will be rendered inside
the `<label>` element.

##### labelProps
This is an optional object that can be used to override or enrich the props that passed to the 
`<label>` element.

For example, if you want to add a specific `className` to the `<label>` element you can do this:

```
 {props => (
    <Input
        {...props}
        requiredText="( required )"
        labelProps={{
            className: 'special-label-class'            
        }}
        labelText="Pet type"
    />
)}
```

##### contentHintText
Every `Input` can also have `content hint text`. This is text that describes what should be
entered into the input. For example, that the input required at least five characters.

The `<input> placeholder` attributes is often used for this, but this is **wrong**. The placeholder
should **never** be used for this function as it causes difficulty for many users out there.

Specify a content hint text as follows:

```
 {props => (
    <Input
        {...props}
        requiredText="( required )"
        labelText="Pet name"
        contentHintText="The pet's name should be longer than three characters" 
    />
)}
```

Content hints are rendered as follows:

<Form
    onSubmit={submitData => {
        alert(JSON.stringify(submitData));
    }}
>
    {({ formControls }) => (
    <>
        <Form.TextInputController
            name="petName"
            required="true"
            validators={[
                validator(isRequired, 'A name is required for your pet'),
                validator(
                    isLongerThan(3), 
                    'The name is too short'
                )
            ]}
        >
            {props => (
                <Input
                    {...props}
                    requiredText="( required )"
                    labelText="Pet type"
                    contentHintText="The name should be longer than 3 characters"
                />
            )}
        </Form.TextInputController>
        <button type="submit">Submit</button>
     </>   
    )}
</Form>

Should you open the browser's HTML inspector, you will find that the content hint container
is linked to the `<input>` element with the `aria-describedby` property. This is very important
for screen readers.

##### requiredText
With this prop you can set the text that displays next to the `<label>` text for required fields.

If you do not set this, a `*` will be shown for required fields as this is a standard pattern
on the web. If you use this, please put a legend somewhere on your form that indicates that a
`*` denotes a required field. 

You don't have to do any more than that as `Tenon-UI` already marks required fields in a way
that screen readers can interpret. 

##### Tenon-UI specific props

Should you look at the code for the `Input` component, you will see that it also expects a number 
of other props. These are the props that is provided by the `TextInputController` component as
seen in the examples above. 

Please do not provide these props yourself as this will most probably break the functionality of
the component.

##### Other props
Any other props given to this component will be passed onto the `<input>` element. 

#### Overriding the input type
By default an `<input type="text">` will be rendered. But this can also be overridden.

The `TextInputController` will also play nice with other types.

Override it like this:
```
{props => (
    <Input
        {...props}
        labelText="Pet's age"
        type="number"
    />
)}
```

#### Refs
In some case you may want to create a [React ref](https://reactjs.org/docs/refs-and-the-dom.html)
to the input field.

In accessible applications, this is mostly done in cases where you want to set focus to a specific 
element.

The `Input` component will [forward your ref](https://reactjs.org/docs/forwarding-refs.html) to
the `<input>` element. 

```
//...
this.inputRef = React.createRef();
//...
{props => (
    <Input
        {...props}
        labelText="Pet's age"
        ref={this.inputRef}
    />
)}
```

If you then set focus with `this.inputRef.current.focus();`, the contained input will be focused, as expected.

### Creating your own view

Every view component on the `Tenon-UI` smart form is completely replaceable.

If you want to create your own view simply make direct use of the `prop getter` functions 
as well as other props provided by the `TextAreaController`.

#### Available prop getters
The `TextInputController` gives you access to the following prop getter functions:

##### getLabelProps
This prop getter generates the required props for the `<label>` element.

##### getInputProps
This prop getter generates the required props for the `<input>` element.

##### getErrorProps
This prop getter generates the required props for the container element of your
displayed errors.

##### getContentHintProps
This prop getter generates the required props for the container element of your
content hint text.

#### Other props
A number of other props are also exposed by the `TextInputController`. Refer to the 
[smart controllers page](/forms-smart-controllers) to see how validators work:

##### showError
This boolean value will indicate to the view if an error should be shown. Normally, errors
will only be shown after the first submit attempt unless overridden by the `alwaysShowErrors`
prop of the [Form component](/forms-form-component).

Use this to easily hide and show your error containers. 

##### errorText
This value contains the current actual error message text. For valid or non-validated fields
this will be empty. Otherwise if will contain the text from the first failing validator as 
specified on the `TextInputController`. 

##### required
This boolean value indicates if the `TextInputController` has been marked as `required`. This
can be handy to decide when to render required indicators.

#### Basic non-validated input
If you only need a label you can write view code resembling this:

```
import { Form } from '@tenon-io/tenon-ui';

//...

<Form.TextInputController name="petName">
    {({ getLabelProps, getInputProps }) => (
        <React.Fragment>
            <label {...getLabelProps()}>
                Enter your pet's name:
            </label>
            <input
                {...getInputProps()}
            />
        </React.Fragment>
    )}
</Form.TextInputController>
```

**Note**: that both the `getLabelProps` and the `getInputProps` prop getters can be called 
with an object that can override and / or enrich the props object returned by these prop getters. 
For example:

```
<input
    {...getInputProps({
        type: "number",
        className: "some-custom-style"
    })}
/>
```

#### Required validated input
For validation, you can make use of the `getErrorProps` prop getter as well.

```
import { Form, validator, isRequired } from '@tenon-io/tenon-ui';

//...

<Form.TextInputController
    name="petName"
    validators={[
        validator(isRequired, 'A name is required.')
    ]}
    required="true"
>
    {({
        getLabelProps,
        getInputProps,
        getErrorProps,
        showError,
        errorText,
        required
    }) => (
        <React.Fragment>
            <label {...getLabelProps()}>
                Enter your pet's name:
                {required && (
                    <span
                        aria-hidden="true"
                    >
                      ( required )
                    </span>
                )}
            </label>
            <input {...getInputProps()} />
            {showError && (
                <div
                    {...getErrorProps({
                        className: 'error-container'
                    })}
                >
                    {errorText}
                </div>
            )}
        </React.Fragment>
    )}
</Form.TextInputController>
```

Note in the example above that the visual `( required )` text is marked with `aria-hidden="true"`. This
is because the `TextInputController` already marks the input as `required` with the 
`aria-required` property. Therefore you need to make sure that this is not read out twice with
screen readers.

The prop getters will ensure that the error text field is linked to the input and that the input
validity (`aria-valid`) is managed and read out by screen readers. 

#### Input with a content hint
Should you want to render a `content hint`, please make use of the `getContentHintProps` prop getter:

```
<Form.TextInputController
    name="petName"
    validators={[
        validator(
            isLongerThan(3),
            'The name is not long enough.'
        )
    ]}
>
    {({
        getLabelProps,
        getInputProps,
        getErrorProps,
        getContentHintProps,
        showError,
        errorText
    }) => (
        <div>
            <label {...getLabelProps()}>
                Enter your pet's name:
            </label>
            <input {...getInputProps()} />
            <div
                {...getContentHintProps({
                    className: 'content-hint-container'
                })}
            >
                The name should be longer than 3
                characters.
            </div>
            {showError && (
                <div
                    {...getErrorProps({
                        className: 'error-container'
                    })}
                >
                    {errorText}
                </div>
            )}
        </div>
    )}
</Form.TextInputController>
```

The prop getter will ensure that the `content hint` is also linked to the `<input>` field so that
screen readers are aware of this.

As shown above you can easily combine this with an error field, although content hint can safely be
rendered on its own. 

#### Disclaimer
The `TextInputController` provides all the function to create fully accessible `<input>` fields, however,
this needs to be backed up with an accessible HTML view. We can unfortunately not guarantee that
every view will be accessible unless the view component follows the same guidelines as our own view
components. 

Feel free to mix up the HTML but ensure that all elements are present and that the prop getters are 
applied correctly.

And be sure to test with screen readers. 

